import{JoomlaEditor as d,JoomlaEditorDecorator as E}from"editor-api";/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */const g={},h=(o,t,s)=>{g[t.id]&&clearTimeout(g[t.id]),g[t.id]=setTimeout(()=>{o.remove(),d.unregister(t.id),Joomla.JoomlaTinyMCE.setupEditor(t,s)},500)};class p extends E{getValue(){return this.instance.getContent()}setValue(t){return this.instance.setContent(t),this}getSelection(){return this.instance.selection.getContent({format:"text"})}replaceSelection(t){return this.instance.execCommand("mceInsertContent",!1,t),this}disable(t){return this.instance.setMode(t?"design":"readonly"),this}toggle(t){let s=!1;return t||this.instance.isHidden()?(this.instance.show(),s=!0):this.instance.hide(),s}}Joomla.JoomlaTinyMCE={setupEditors:o=>{const t=o||document,s=Joomla.getOptions("plg_editor_tinymce",{});t.querySelectorAll(".js-editor-tinymce").forEach(a=>{const e=a.querySelector("textarea"),r=a.querySelector(".js-tiny-toggler-button"),c=r?r.querySelector(".icon-eye"):!1;Joomla.JoomlaTinyMCE.setupEditor(e,s),r&&r.removeAttribute("disabled"),a.addEventListener("click",m=>{d.setActive(e.id);const i=m.target.closest(".js-tiny-toggler-button"),l=d.getActive();if(i&&l){const n=l.toggle();c&&c.setAttribute("class",n?"icon-eye":"icon-eye-slash")}})})},setupEditor:(o,t)=>{if(d.get(o.id))return;const s=o?o.getAttribute("name").replace(/\[\]|\]/g,"").split("[").pop():"default",u=t?t.tinyMCE||{}:{},a=u.default||{};let e=u[s]?u[s]:a;e.joomlaMergeDefaults?e=Joomla.extend(Joomla.extend({},a),e):e=Joomla.extend({},e),o&&(e.selector=null,e.target=o);const r=e.skin_light,c=e.skin_dark;if(delete e.skin_light,delete e.skin_dark,e.skin=r,"colorSchemeOs"in document.documentElement.dataset){const n=window.matchMedia("(prefers-color-scheme: dark)");e.skin=n.matches?c:r}else document.documentElement.dataset.colorScheme==="dark"&&(e.skin=c);let m=!1;o&&(m=o.readOnly),e.setup=n=>{n.mode.set(m?"readonly":"design")},e.init_instance_callback=n=>{n.on("submit",()=>{n.isHidden()&&n.show()},!0)};const i=new tinyMCE.Editor(o.id,e,tinymce.EditorManager),l=new p(i,"tinymce",o.id);if(!i.inline){let n=!1,f=!1;const y=()=>{i.getContentAreaContainer().querySelector("iframe").addEventListener("load",()=>{h(i,o,t)})};i.on("load",()=>{n=!0,f&&y()}),i.on("PostRender",()=>{f=!0,n&&y()})}i.on("focus",()=>{d.setActive(l)}),i.render(),d.register(l)}},document.addEventListener("DOMContentLoaded",()=>{Joomla.JoomlaTinyMCE.setupEditors(document)}),document.addEventListener("joomla:updated",({target:o})=>Joomla.JoomlaTinyMCE.setupEditors(o));
