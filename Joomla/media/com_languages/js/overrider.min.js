/**
 * @copyright  (C) 2018 Open Source Matters, Inc. <https://www.joomla.org>
 * @license    GNU General Public License version 2 or later; see LICENSE.txt
 */((r,e)=>{class o{constructor(){this.states={refreshing:!1,refreshed:!1,counter:0,searchString:"",searchType:"value"},this.spinner=e.getElementById("overrider-spinner"),this.spinnerBtn=e.getElementById("overrider-spinner-btn"),this.moreResults=e.getElementById("more-results"),this.moreResultsButton=e.getElementById("more-results-button"),this.resultsContainer=e.getElementById("results-container"),this.refreshStatus=e.getElementById("refresh-status")}refreshCache(){this.states.refreshing=!0,this.refreshStatus.classList.add("show"),r.request({url:"index.php?option=com_languages&task=strings.refresh&format=json",method:"POST",headers:{"Content-Type":"application/json"},onSuccess:t=>{t.error&&t.message&&alert(t.message),t.messages&&r.renderMessages(t.messages),this.refreshStatus.classList.remove("show"),this.states.refreshing=!1},onError:()=>{alert(r.Text._("COM_LANGUAGES_VIEW_OVERRIDE_REQUEST_ERROR")),this.refreshStatus.classList.remove("show")}})}searchStrings(t){if(this.states.refreshing)return;const a=e.getElementById("jform_searchstring"),n=e.getElementById("jform_searchtype");if(t||(this.states.searchString=a.value,this.states.searchType=n.value||"value",e.querySelectorAll(".language-results").forEach(i=>i.parentNode.removeChild(i))),!this.states.searchString){a.classList.add("invalid");return}t?this.spinnerBtn.classList.add("show"):(this.moreResults.classList.remove("show"),e.querySelectorAll("#results-container div.language-results").forEach(i=>i.parentNode.removeChild(i)),this.resultsContainer.classList.add("show"),this.spinner.classList.add("show")),r.request({url:`index.php?option=com_languages&task=strings.search&format=json&searchstring=${this.states.searchString}&searchtype=${this.states.searchType}&more=${t}`,method:"POST",headers:{"Content-Type":"application/json"},onSuccess:i=>{const s=JSON.parse(i);s.error&&s.message&&alert(s.message),s.messages&&r.renderMessages(s.messages),s.data&&(s.data.results&&r.overrider.insertResults(s.data.results),s.data.more?(this.states.more=s.data.more,this.moreResultsButton.disabled=!1,this.moreResults.classList.add("show")):(this.moreResultsButton.disabled=!0,this.moreResults.classList.remove("show"))),this.spinnerBtn.classList.remove("show"),this.spinner.classList.remove("show")},onError:()=>{alert(r.Text._("COM_LANGUAGES_VIEW_OVERRIDE_REQUEST_ERROR")),this.moreResultsButton.disabled=!0,this.moreResults.classList.remove("show"),this.resultsContainer.classList.remove("show")}})}insertResults(t){this.states.counter+=1;const a=e.createElement("div");if(a.setAttribute("id",`language-results${this.states.counter}`),a.classList.add("language-results","list-group","mb-2","show"),t.forEach((n,i)=>{const s=e.createElement("a");s.setAttribute("onclick",`Joomla.overrider.selectString(${this.states.counter}${i});`),s.setAttribute("href","#"),s.classList.add("list-group-item","list-group-item-action","flex-column","align-items-start");const l=e.createElement("div");l.setAttribute("id",`override_key${this.states.counter}${i}`),l.setAttribute("title",n.file),l.classList.add("result-key"),l.innerHTML=r.sanitizeHtml(n.constant);const h=e.createElement("div");h.setAttribute("id",`override_string${this.states.counter}${i}`),h.classList.add("result-string"),h.innerHTML=r.sanitizeHtml(n.string),s.appendChild(l),s.appendChild(h),a.appendChild(s)}),!t.length){const n=e.createElement("div");n.innerText=r.Text._("COM_LANGUAGES_VIEW_OVERRIDE_NO_RESULTS"),a.appendChild(n)}this.moreResults&&this.moreResults.parentNode.insertBefore(a,this.moreResults)}selectString(t){e.getElementById("jform_key").value=e.getElementById(`override_key${t}`).innerHTML,e.getElementById("jform_override").value=e.getElementById(`override_string${t}`).innerHTML}}e.addEventListener("DOMContentLoaded",()=>{r.overrider=new o})})(Joomla,document);
